{"version":3,"sources":["../../src/component/Popup.tsx"],"names":["Popup","React","createPortal","SceneContext","PopupComponet","props","el","scene","popup","document","createElement","lnglat","children","option","p","setLnglat","setDOMContent","addPopup","prevProps","positionChanged","toString","remove","Consumer","PureComponent"],"mappings":";;;;;;;;;;AAAA,SAMEA,KANF,QAQO,UARP;AASA,OAAO,KAAKC,KAAZ,MAAuB,OAAvB;AACA,SAASC,YAAT,QAA6B,WAA7B;AACA,SAASC,YAAT,QAA6B,gBAA7B;;IAMqBC,a;;;;;AAInB,yBAAYC,KAAZ,EAAgC;AAAA;;AAAA;;AAC9B,8BAAMA,KAAN;AAD8B,UAHxBC,EAGwB;AAAA,UAFxBC,KAEwB;AAAA,UADxBC,KACwB;AAE9B,UAAKF,EAAL,GAAUG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AAF8B;AAG/B;;;;wCAC0B;AAAA,wBACY,KAAKL,KADjB;AAAA,UACjBM,MADiB,eACjBA,MADiB;AAAA,UACTC,QADS,eACTA,QADS;AAAA,UACCC,MADD,eACCA,MADD;AAEzB,UAAMC,CAAC,GAAG,IAAId,KAAJ,CAAUa,MAAV,CAAV;;AAEA,UAAIF,MAAJ,EAAY;AACVG,QAAAA,CAAC,CAACC,SAAF,CAAYJ,MAAZ;AACD;;AACD,UAAIC,QAAJ,EAAc;AACZE,QAAAA,CAAC,CAACE,aAAF,CAAgB,KAAKV,EAArB;AACD;;AACD,WAAKE,KAAL,GAAaM,CAAb;AACA,WAAKP,KAAL,CAAWU,QAAX,CAAoBH,CAApB;AACD;;;uCAEyBI,S,EAAwB;AAAA;;AAChD,UAAMC,eAAe,GACnB,CAAAD,SAAS,SAAT,IAAAA,SAAS,WAAT,iCAAAA,SAAS,CAAEP,MAAX,wEAAmBS,QAAnB,yBAAkC,KAAKf,KAAvC,wEAAkC,aAAYM,MAA9C,wDAAkC,oBAAoBS,QAApB,EAAlC,CADF;;AAGA,UAAID,eAAJ,EAAqB;AACnB,aAAKX,KAAL,CAAWa,MAAX;AACA,aAAKb,KAAL,GAAa,IAAIR,KAAJ,CAAU,KAAKK,KAAL,CAAWQ,MAArB,CAAb;AACA,aAAKL,KAAL,CAAWO,SAAX,CAAqB,KAAKV,KAAL,CAAWM,MAAhC;AACA,aAAKH,KAAL,CAAWQ,aAAX,CAAyB,KAAKV,EAA9B;AACA,aAAKC,KAAL,CAAWU,QAAX,CAAoB,KAAKT,KAAzB;AACD;AACF;;;2CAE6B;AAC5B,WAAKA,KAAL,CAAWa,MAAX;AACD;;;6BAEe;AAAA;;AACd,aAAOpB,KAAK,CAACS,aAAN,CACLP,YAAY,CAACmB,QADR,EAGL,EAHK,EAIL,UAACf,KAAD,EAAkB;AAChB,YAAIA,KAAJ,EAAW;AACT,UAAA,MAAI,CAACA,KAAL,GAAaA,KAAb;AACD;;AAED,eAAOL,YAAY,CAAC,MAAI,CAACG,KAAL,CAAWO,QAAZ,EAAsB,MAAI,CAACN,EAA3B,CAAnB;AACD,OAVI,CAAP;AAYD;;;;EApDwCL,KAAK,CAACsB,a;;SAA5BnB,a","sourcesContent":["import {\n  IActiveOption,\n  IImage,\n  ILayer,\n  ILngLat,\n  IPopupOption,\n  Popup,\n  Scene,\n} from '@antv/l7';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { SceneContext } from './SceneContext';\ninterface IPopupProps {\n  option?: Partial<IPopupOption>;\n  lnglat: number[];\n  children?: React.ReactNode;\n}\nexport default class PopupComponet extends React.PureComponent<IPopupProps> {\n  private el: HTMLDivElement;\n  private scene: Scene;\n  private popup: Popup;\n  constructor(props: IPopupProps) {\n    super(props);\n    this.el = document.createElement('div');\n  }\n  public componentDidMount() {\n    const { lnglat, children, option } = this.props;\n    const p = new Popup(option);\n\n    if (lnglat) {\n      p.setLnglat(lnglat);\n    }\n    if (children) {\n      p.setDOMContent(this.el);\n    }\n    this.popup = p;\n    this.scene.addPopup(p);\n  }\n\n  public componentDidUpdate(prevProps: IPopupProps) {\n    const positionChanged =\n      prevProps?.lnglat?.toString() !== this.props?.lnglat?.toString();\n\n    if (positionChanged) {\n      this.popup.remove();\n      this.popup = new Popup(this.props.option);\n      this.popup.setLnglat(this.props.lnglat);\n      this.popup.setDOMContent(this.el);\n      this.scene.addPopup(this.popup);\n    }\n  }\n\n  public componentWillUnmount() {\n    this.popup.remove();\n  }\n\n  public render() {\n    return React.createElement(\n      SceneContext.Consumer,\n      // @ts-ignore\n      {},\n      (scene: Scene) => {\n        if (scene) {\n          this.scene = scene;\n        }\n\n        return createPortal(this.props.children, this.el);\n      },\n    );\n  }\n}\n"],"file":"Popup.js"}