{"version":3,"sources":["../../src/component/Popup.tsx"],"names":["PopupComponet","props","el","scene","popup","document","createElement","lnglat","children","option","p","Popup","setLnglat","setDOMContent","addPopup","prevProps","positionChanged","toString","remove","React","SceneContext","Consumer","PureComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;AASA;;AACA;;AACA;;;;;;IAMqBA,a;;;;;AAInB,yBAAYC,KAAZ,EAAgC;AAAA;;AAAA;AAC9B,8BAAMA,KAAN;AAD8B,UAHxBC,EAGwB;AAAA,UAFxBC,KAEwB;AAAA,UADxBC,KACwB;AAE9B,UAAKF,EAAL,GAAUG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AAF8B;AAG/B;;;;wCAC0B;AAAA,wBACY,KAAKL,KADjB;AAAA,UACjBM,MADiB,eACjBA,MADiB;AAAA,UACTC,QADS,eACTA,QADS;AAAA,UACCC,MADD,eACCA,MADD;AAEzB,UAAMC,CAAC,GAAG,IAAIC,QAAJ,CAAUF,MAAV,CAAV;;AAEA,UAAIF,MAAJ,EAAY;AACVG,QAAAA,CAAC,CAACE,SAAF,CAAYL,MAAZ;AACD;;AACD,UAAIC,QAAJ,EAAc;AACZE,QAAAA,CAAC,CAACG,aAAF,CAAgB,KAAKX,EAArB;AACD;;AACD,WAAKE,KAAL,GAAaM,CAAb;AACA,WAAKP,KAAL,CAAWW,QAAX,CAAoBJ,CAApB;AACD;;;uCAEyBK,S,EAAwB;AAAA;;AAChD,UAAMC,eAAe,GACnB,CAAAD,SAAS,SAAT,IAAAA,SAAS,WAAT,iCAAAA,SAAS,CAAER,MAAX,wEAAmBU,QAAnB,yBAAkC,KAAKhB,KAAvC,wEAAkC,aAAYM,MAA9C,wDAAkC,oBAAoBU,QAApB,EAAlC,CADF;;AAGA,UAAID,eAAJ,EAAqB;AACnB,aAAKZ,KAAL,CAAWc,MAAX;AACA,aAAKd,KAAL,GAAa,IAAIO,QAAJ,CAAU,KAAKV,KAAL,CAAWQ,MAArB,CAAb;AACA,aAAKL,KAAL,CAAWQ,SAAX,CAAqB,KAAKX,KAAL,CAAWM,MAAhC;AACA,aAAKH,KAAL,CAAWS,aAAX,CAAyB,KAAKX,EAA9B;AACA,aAAKC,KAAL,CAAWW,QAAX,CAAoB,KAAKV,KAAzB;AACD;AACF;;;2CAE6B;AAC5B,WAAKA,KAAL,CAAWc,MAAX;AACD;;;6BAEe;AAAA;;AACd,aAAOC,KAAK,CAACb,aAAN,CACLc,2BAAaC,QADR,EAGL,EAHK,EAIL,UAAClB,KAAD,EAAkB;AAChB,YAAIA,KAAJ,EAAW;AACT,UAAA,MAAI,CAACA,KAAL,GAAaA,KAAb;AACD;;AAED,eAAO,4BAAa,MAAI,CAACF,KAAL,CAAWO,QAAxB,EAAkC,MAAI,CAACN,EAAvC,CAAP;AACD,OAVI,CAAP;AAYD;;;EApDwCiB,KAAK,CAACG,a","sourcesContent":["import {\n  IActiveOption,\n  IImage,\n  ILayer,\n  ILngLat,\n  IPopupOption,\n  Popup,\n  Scene,\n} from '@antv/l7';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { SceneContext } from './SceneContext';\ninterface IPopupProps {\n  option?: Partial<IPopupOption>;\n  lnglat: number[];\n  children?: React.ReactNode;\n}\nexport default class PopupComponet extends React.PureComponent<IPopupProps> {\n  private el: HTMLDivElement;\n  private scene: Scene;\n  private popup: Popup;\n  constructor(props: IPopupProps) {\n    super(props);\n    this.el = document.createElement('div');\n  }\n  public componentDidMount() {\n    const { lnglat, children, option } = this.props;\n    const p = new Popup(option);\n\n    if (lnglat) {\n      p.setLnglat(lnglat);\n    }\n    if (children) {\n      p.setDOMContent(this.el);\n    }\n    this.popup = p;\n    this.scene.addPopup(p);\n  }\n\n  public componentDidUpdate(prevProps: IPopupProps) {\n    const positionChanged =\n      prevProps?.lnglat?.toString() !== this.props?.lnglat?.toString();\n\n    if (positionChanged) {\n      this.popup.remove();\n      this.popup = new Popup(this.props.option);\n      this.popup.setLnglat(this.props.lnglat);\n      this.popup.setDOMContent(this.el);\n      this.scene.addPopup(this.popup);\n    }\n  }\n\n  public componentWillUnmount() {\n    this.popup.remove();\n  }\n\n  public render() {\n    return React.createElement(\n      SceneContext.Consumer,\n      // @ts-ignore\n      {},\n      (scene: Scene) => {\n        if (scene) {\n          this.scene = scene;\n        }\n\n        return createPortal(this.props.children, this.el);\n      },\n    );\n  }\n}\n"],"file":"Popup.js"}